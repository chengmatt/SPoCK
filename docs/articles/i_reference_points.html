<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Deriving Reference Points, Catch Advice, and Projections • SPoRC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deriving Reference Points, Catch Advice, and Projections">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SPoRC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Deriving Reference Points, Catch Advice, and Projections</h1>
            
      

      <div class="d-none name"><code>i_reference_points.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chengmatt.github.io/SPoRC">SPoRC</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaskr/RTMB" class="external-link">RTMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<p>Several options exist for deriving management reference points and
catch advice in <code>SPoRC</code>. In this vignette, we will first
discuss the mathematical details for deriving different management
reference points, and then demonstrate how catch advice might be
developed with estimated reference points.</p>
<div class="section level2">
<h2 id="reference-points">Reference Points<a class="anchor" aria-label="anchor" href="#reference-points"></a>
</h2>
<p>Management reference points in <code>SPoRC</code> are divided into
single-region and spatial reference points.</p>
<p>Single-region reference points include:</p>
<ul>
<li><p>Spawning potential ratio (SPR) reference points, which estimate
the fishing mortality rate that reduces spawning biomass per recruit to
x% of the unfished level.</p></li>
<li><p>Maximum sustainable yield (MSY) reference points, based on a
Beverton-Holt relationship, which estimate the fishing mortality rate
that maximizes long-term yield.</p></li>
</ul>
<p>Spatial reference points also include both SPR and MSY-based metrics,
but are further divided into:</p>
<ul>
<li><p>Independent SPR reference points, which estimate region-specific
fishing mortality rates that reduce spawning biomass per recruit to x%
of the unfished level, while ignoring movement.</p></li>
<li><p>Independent MSY reference points, which estimate region-specific
fishing mortality rates that maximize yield within a given
region.</p></li>
<li><p>Global SPR reference points, which estimate a global fishing
mortality rate that reduces total spawning biomass per recruit to x% of
the unfished level, accounting for movement.</p></li>
<li><p>Global MSY reference points, which estimate a global fishing
mortality rate that maximizes long-term yield across all
regions.</p></li>
</ul>
<div class="section level3">
<h3 id="single-region">Single Region<a class="anchor" aria-label="anchor" href="#single-region"></a>
</h3>
<div class="section level4">
<h4 id="sglregionspr">Spawning Potential Ratio Reference Points<a class="anchor" aria-label="anchor" href="#sglregionspr"></a>
</h4>
<p>To derive SPR reference points, users must specify a target
percentage representing the spawning biomass per recruit under fishing
relative to the unfished level. Following that, several additional
quantities are needed to compute these reference points. This
includes:</p>
<ul>
<li>the relative fishing mortality between fleets
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>r</mi><mi>a</mi><msub><mi>t</mi><mi>f</mi></msub><mo>=</mo><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>f</mi></msub><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Frat_f = Fmort_{y = term,f} / \sum_f Fmort_{y = term,f}</annotation></semantics></math>),</li>
<li>fleet-specific fishery selectivity
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>e</mi><msubsup><mi>l</mi><mrow><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mrow><mi>F</mi><mi>s</mi><mi>h</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">Sel_{y = term,a,s = 1,f}^{Fsh}</annotation></semantics></math>),</li>
<li>natural mortality for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">NatMort_{y=1,a,s=1}</annotation></semantics></math>),</li>
<li>weight at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">W_{y=1,a,s=1}</annotation></semantics></math>),</li>
<li>maturity at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">Mat_{y=1,a,s=1}</annotation></semantics></math>),</li>
<li>spawn timing
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>s</mi><mi>p</mi><mi>w</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">t_{spwn}</annotation></semantics></math>),</li>
<li>a vector of recruitment values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>y</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Rec_{y,s}</annotation></semantics></math>),</li>
<li>the recruitment sex ratio
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ψ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\psi_s</annotation></semantics></math>),</li>
<li>recruitment age
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">RecAge</annotation></semantics></math>),
and</li>
<li>the first year in the recruitment vector
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">RecYear</annotation></semantics></math>)
to be used for mean recruitment calculations.</li>
</ul>
<p>For relative fishing mortality between fleets and fleet-specific
fishery selectivity, the terminal year is utilized for these
calculations. By contrast, estimates from the first model year are
utilized for natural mortality, weight at age, and maturity at age.</p>
<p>SPR reference points are then derived with the following process:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
N_{a = 1}^{fished} = 1
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>u</mi><mi>n</mi><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
N_{a = 1}^{unfished} = 1
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>N</mi><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><annotation encoding="application/x-tex">N_{a = 1}^{fished}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>N</mi><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>u</mi><mi>n</mi><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><annotation encoding="application/x-tex">N_{a = 1}^{unfished}</annotation></semantics></math>
are the fished and unfished numbers at age per-recruit, respectively,
for the first age class. Subsequent numbers at age per-recruit are then
computed with an exponential mortality model, where fished numbers at
age per-recruit are decremented with both natural and fishing mortality,
while unfished numbers at age per-recruit are only decremented with
natural mortality:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mi>x</mi></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mfrac><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mi>x</mi></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mi>x</mi></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
N_{a}^{\text{fished}} = 
\begin{cases}
N_{a - 1}^{\text{fished}} \cdot \exp\left(-\left(NatMort_{y=1,a-1,s=1} + \sum_f \text{Frat}_f \cdot F_x \cdot \text{Sel}_{y=\text{term},a-1,s=1,f}^{\text{Fsh}}\right)\right) &amp; \text{if } 2 &lt; a &lt; n_{\text{ages}} \\
\\
N_{a - 1}^{\text{fished}} \cdot 
\frac{
\exp\left(-\left(NatMort_{y=1,n_{\text{ages}}-1,s=1} + \sum_f \text{Frat}_f \cdot F_x \cdot \text{Sel}_{y=\text{term},n_{\text{ages}}-1,s=1,f}^{\text{Fsh}}\right)\right)
}{
1 - \exp\left(-\left(NatMort_{y=1,n_{\text{ages}},s=1} + \sum_f \text{Frat}_f \cdot F_x \cdot \text{Sel}_{y=\text{term},n_{\text{ages}},s=1,f}^{\text{Fsh}}\right)\right)
} &amp; \text{if } a = n_{\text{ages}}
\end{cases}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mfrac><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
N_{a}^{\text{unfished}} = 
\begin{cases}
N_{a - 1}^{\text{unfished}} \cdot \exp\left(-NatMort_{y=1,a-1,s=1}\right) &amp; \text{if } 2 &lt; a &lt; n_{\text{ages}} \\
\\
N_{a - 1}^{\text{unfished}} \cdot 
\frac{
\exp\left(-NatMort_{y=1,n_{\text{ages}}-1,s=1}\right)
}{
1 - \exp\left(-NatMort_{y=1,n_{\text{ages}},s=1}\right)
} &amp; \text{if } a = n_{\text{ages}}
\end{cases}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>x</mi></msub><annotation encoding="application/x-tex">F_x</annotation></semantics></math>
represents the estimated fishing mortality rate that reduces the
spawning biomass per recruit to x%, relative to the unfished level.
Fished and unfished numbers at age per recruit can then be converted to
spawning biomass per recruit quantities
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">SSB</annotation></semantics></math>)
with the following equations:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">fished</mtext></msup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mi>x</mi></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB^{\text{fished}} = \sum_a N_{a}^{\text{fished}} \cdot W_{y=1,a,s=1} \cdot \text{Mat}_{y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{y=1,a,s=1} + \sum_f \text{Frat}_f \cdot F_x \cdot \text{Sel}_{y=\text{term},a,s=1,f}^{\text{Fsh}} \right)
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">unfished</mtext></msup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB^{\text{unfished}} = \sum_a N_{a}^{\text{unfished}} \cdot W_{y=1,a,s=1} \cdot \text{Mat}_{y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{y=1,a,s=1} \right)
</annotation></semantics></math></p>
<p>SPR is then defined as the fraction of fished and unfished spawning
biomass per recruit:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>P</mi><mi>R</mi><mo>=</mo><mfrac><mrow><mi>S</mi><mi>S</mi><msup><mi>B</mi><mrow><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msup></mrow><mrow><mi>S</mi><mi>S</mi><msup><mi>B</mi><mrow><mi>u</mi><mi>n</mi><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">
SPR = \frac{SSB^{fished}}{SSB^{unfished}}
</annotation></semantics></math></p>
<p>and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>x</mi></msub><annotation encoding="application/x-tex">F_x</annotation></semantics></math>
is solved for using a non-linear function minimizer by minimizing the
following criteria:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>x</mi></msub><mo>=</mo><mo>arg</mo><munder><mo>min</mo><mi>F</mi></munder><mrow><mo stretchy="true" form="prefix">{</mo><mn>100</mn><mo>⋅</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">SPR</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>F</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mtext mathvariant="normal">x%</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">
F_x = \arg\min_{F} \left\{ 100 \cdot \left( \text{SPR}(F) - \text{x%} \right)^2 \right\}
</annotation></semantics></math></p>
<p>Biological SPR-based reference points
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mi>x</mi></msub><annotation encoding="application/x-tex">B_x</annotation></semantics></math>)
can then be derived by multiplying the fished spawning biomass per
recruit by mean recruitment over a user-defined period and the
recruitment sex-ratio:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>x</mi></msub><mo>=</mo><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">fished</mtext></msup><mo>⋅</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><mrow><mi>Y</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi></mrow></munderover><mi>R</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>y</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><mrow><mi>Y</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></mfrac><msub><mi>ψ</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">
B_x = SSB^{\text{fished}} \cdot \frac{\sum_{RecYear}^{Y - RecAge} Rec_{y,s}}{Y - RecAge - RecYear} \psi_s
</annotation></semantics></math></p>
</div>
<div class="section level4">
<h4 id="sglregionmsy">Maximum Sustainable Yield Reference Points (Beverton-Holt)<a class="anchor" aria-label="anchor" href="#sglregionmsy"></a>
</h4>
<p>Deriving MSY based reference points using a Beverton-Holt stock
recruitment relationship involves maximizing the equilibrium yield per
recruit and requires several additional inputs. For completeness, we
summarize the required inputs to derive MSY based reference points when
assuming a Beverton-Holt relationship. These inputs include:</p>
<ul>
<li>the relative fishing mortality between fleets
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>r</mi><mi>a</mi><msub><mi>t</mi><mi>f</mi></msub><mo>=</mo><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>f</mi></msub><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Frat_f = Fmort_{y = term,f} / \sum_f Fmort_{y = term,f}</annotation></semantics></math>),</li>
<li>fleet-specific fishery selectivity
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>e</mi><msubsup><mi>l</mi><mrow><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mrow><mi>F</mi><mi>s</mi><mi>h</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">Sel_{y = term,a,s = 1,f}^{Fsh}</annotation></semantics></math>),</li>
<li>natural mortality for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">NatMort_{y=1,a,s=1}</annotation></semantics></math>),</li>
<li>weight at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">W_{y=1,a,s=1}</annotation></semantics></math>),</li>
<li>maturity at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">Mat_{y=1,a,s=1}</annotation></semantics></math>),</li>
<li>an estimate of virgin recruitment
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>),</li>
<li>an estimate of steepness
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>),</li>
<li>the recruitment sex ratio
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ψ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\psi_s</annotation></semantics></math>).</li>
</ul>
<p>Similarly, for relative fishing mortality between fleets and
fleet-specific fishery selectivity, terminal year estimates are utilized
for these calculations. By contrast, estimates from the first model year
are utilized for natural mortality, weight at age, and maturity at
age.</p>
<p>MSY reference points can then be derived using the standard
per-recruit calculations, where the initial number of fished and
unfished individuals can be set at an arbitrary value:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
N_{a = 1}^{fished} = 1 
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>u</mi><mi>n</mi><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
N_{a = 1}^{unfished} = 1
</annotation></semantics></math></p>
<p>The following numbers-at-age per recruit are then decremented with an
exponential mortality model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mfrac><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
  N_{a}^{\text{fished}} = 
    \begin{cases}
  N_{a - 1}^{\text{fished}} \cdot \exp\left(-\left(NatMort_{y=1,a-1,s=1} + \sum_f \text{Frat}_f \cdot F_{msy} \cdot \text{Sel}_{y=\text{term},a-1,s=1,f}^{\text{Fsh}}\right)\right) &amp; \text{if } 2 &lt; a &lt; n_{\text{ages}} \\
  \\
  N_{a - 1}^{\text{fished}} \cdot 
  \frac{
    \exp\left(-\left(NatMort_{y=1,n_{\text{ages}}-1,s=1} + \sum_f \text{Frat}_f \cdot F_{msy} \cdot \text{Sel}_{y=\text{term},n_{\text{ages}}-1,s=1,f}^{\text{Fsh}}\right)\right)
  }{
    1 - \exp\left(-\left(NatMort_{y=1,n_{\text{ages}},s=1} + \sum_f \text{Frat}_f \cdot F_{msy} \cdot \text{Sel}_{y=\text{term},n_{\text{ages}},s=1,f}^{\text{Fsh}}\right)\right)
  } &amp; \text{if } a = n_{\text{ages}}
  \end{cases}
  </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>N</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mfrac><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
  N_{a}^{\text{unfished}} = 
    \begin{cases}
  N_{a - 1}^{\text{unfished}} \cdot \exp\left(-NatMort_{y=1,a-1,s=1}\right) &amp; \text{if } 2 &lt; a &lt; n_{\text{ages}} \\
  \\
  N_{a - 1}^{\text{unfished}} \cdot 
  \frac{
    \exp\left(-NatMort_{y=1,n_{\text{ages}}-1,s=1}\right)
  }{
    1 - \exp\left(-NatMort_{y=1,n_{\text{ages}},s=1}\right)
  } &amp; \text{if } a = n_{\text{ages}}
  \end{cases}
  </annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">F_{msy}</annotation></semantics></math>
here represents the fishing mortality that would result in equilibrium
yield being maximized. Yield per recruit quantities can then be computed
using Baranov’s catch equation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>a</mi></msub><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mtext mathvariant="normal">msy</mtext></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mtext mathvariant="normal">msy</mtext></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mfrac><mo>⋅</mo><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mtext mathvariant="normal">msy</mtext></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
C_{a} = 
\frac{
  \sum_f \text{Frat}_f \cdot F_{\text{msy}} \cdot \text{Sel}_{y=\text{term},a-1,s=1,f}^{\text{Fsh}}
}{
  \left(NatMort_{y=1,a-1,s=1} + \sum_f \text{Frat}_f \cdot F_{\text{msy}} \cdot \text{Sel}_{y=\text{term},a-1,s=1,f}^{\text{Fsh}}\right)
}
\cdot
N_a^{\text{fished}} \cdot 
\left(
  1 - \exp\left[
    -\left(
      NatMort_{y=1,n_{\text{ages}},s=1} + \sum_f \text{Frat}_f \cdot F_{\text{msy}} \cdot \text{Sel}_{y=\text{term},n_{\text{ages}},s=1,f}^{\text{Fsh}}
    \right)
  \right]
\right)
</annotation></semantics></math></p>
<p>Values for equilibrium recruitment are then calculated using the
Beverton-Holt stock recruitment relationship. Estimates of equilibrium
recruitment are needed to convert per recruit quantities to yield and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{msy}</annotation></semantics></math>.
Here, we first derive the fished and unfished spawning biomass per
recruit:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">fished</mtext></msup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mi>f</mi></msub><mo>⋅</mo><msub><mi>F</mi><mi>x</mi></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB^{\text{fished}} = \sum_a N_{a}^{\text{fished}} \cdot W_{y=1,a,s=1} \cdot \text{Mat}_{y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{y=1,a,s=1} + \sum_f \text{Frat}_f \cdot F_x \cdot \text{Sel}_{y=\text{term},a,s=1,f}^{\text{Fsh}} \right) 
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">unfished</mtext></msup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB^{\text{unfished}} = \sum_a N_{a}^{\text{unfished}} \cdot W_{y=1,a,s=1} \cdot \text{Mat}_{y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{y=1,a,s=1} \right)
</annotation></semantics></math></p>
<p>Equilibrium recruitment can then be derived with the following:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>q</mi><mo>=</mo><mfrac><mrow><mn>4</mn><mo>⋅</mo><mi>h</mi><mo>⋅</mo><msub><mi>R</mi><mn>0</mn></msub><mo>⋅</mo><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">fished</mtext></msup></mrow><mrow><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">unfished</mtext></msup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">fished</mtext></msup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo>⋅</mo><mi>h</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
Req = \frac{4\cdot h \cdot R_0 \cdot SSB^{\text{fished}}}{SSB^{\text{unfished}} \cdot (1 - h) + SSB^{\text{fished}} \cdot (5 \cdot h - 1)}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">Req</annotation></semantics></math>
is the equilibrium recruitment. Yield and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{msy}</annotation></semantics></math>
can then be computed by multiplying the yield per recruit and spawning
biomass per recruit by an estimate of equilibrium recruitment:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msub><mi>C</mi><mi>a</mi></msub><mo>⋅</mo><mi>R</mi><mi>e</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">
Yield = \sum_a C_a \cdot Req 
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>=</mo><mi>S</mi><mi>S</mi><msup><mi>B</mi><mtext mathvariant="normal">fished</mtext></msup><mo>⋅</mo><mi>R</mi><mi>e</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">
B_{msy} = SSB^{\text{fished}} \cdot Req
</annotation></semantics></math></p>
<p>Lastly,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">F_{msy}</annotation></semantics></math>
is solved for using a non-linear function minimizer by minimizing the
following criteria (maximizing yield):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>=</mo><mo>arg</mo><munder><mo>min</mo><mi>F</mi></munder><mi>Y</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">
F_{msy} = \arg\min_{F} Yield
</annotation></semantics></math></p>
</div>
</div>
<div class="section level3">
<h3 id="multi-region">Multi Region<a class="anchor" aria-label="anchor" href="#multi-region"></a>
</h3>
<div class="section level4">
<h4 id="spawning-potential-ratio-reference-points">Spawning Potential Ratio Reference Points<a class="anchor" aria-label="anchor" href="#spawning-potential-ratio-reference-points"></a>
</h4>
<p>In general, multi region SPR reference points can be computed in a
similar manner as single region SPR reference points. The additional
complication to calculating spatial reference points includes the
additional region subscript for all quantities, as well as the
<strong>potential</strong> need to account for movement processes.</p>
<div class="section level5">
<h5 id="independent">Independent<a class="anchor" aria-label="anchor" href="#independent"></a>
</h5>
<p>In the case where users assume no movement occurs among regions, SPR
rates can be calculated independently for each region, which results in
region-specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">F_{r,x}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,x}</annotation></semantics></math>
estimates. Thus, each region has a unique
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">F_{r,x}</annotation></semantics></math>
estimate that can be applied. All calculations are computed in the same
manner as equations described for computing SPR rates in the <a href="#sglregionspr">single region case</a> except that an additional
subscript is added to all demographic rates. Following that,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">F_{r,x}</annotation></semantics></math>
can then be solved for by minimizing the following criteria for each
region:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><mo>=</mo><mo>arg</mo><munder><mo>min</mo><msub><mi>F</mi><mi>r</mi></msub></munder><mrow><mo stretchy="true" form="prefix">{</mo><mn>100</mn><mo>⋅</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">SPR</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>F</mi><mi>r</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mtext mathvariant="normal">x%</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">
F_{r,x} = \arg\min_{F_r} \left\{ 100 \cdot \left( \text{SPR}(F_r) - \text{x%} \right)^2 \right\}
</annotation></semantics></math></p>
<p>Regional biological SPR-based reference points
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mi>x</mi></msub><annotation encoding="application/x-tex">B_x</annotation></semantics></math>)
can then be derived by multiplying the fished spawning biomass per
recruit by regional mean recruitment over a user-defined period and the
recruitment sex-ratio:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><mo>=</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><mrow><mi>Y</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi></mrow></munderover><mi>R</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><mrow><mi>Y</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></mfrac><msub><mi>ψ</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">
B_{r,x} = SSB_r^{\text{fished}} \cdot \frac{\sum_{RecYear}^{Y - RecAge} Rec_{r,y,s}}{Y - RecAge - RecYear} \psi_s
</annotation></semantics></math></p>
</div>
<div class="section level5">
<h5 id="global">Global<a class="anchor" aria-label="anchor" href="#global"></a>
</h5>
<p>In contrast to computing reference points when assuming independent
populations, SPR rates can also be computed globally, where movement
occurs among regions. Given the assumption of global SPR rates, this
results in a global
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>x</mi></msub><annotation encoding="application/x-tex">F_x</annotation></semantics></math>
estimate, but regional estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,x}</annotation></semantics></math>
because mean recruitment estimates are defined regionally. Thus, the
global SPR solution results in a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>x</mi></msub><annotation encoding="application/x-tex">F_x</annotation></semantics></math>
that reduces the global spawning biomass per recruit to x% of its
unfished value, such that the aggregate spawning biomass reaches
equilibrium at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>r</mi></msub><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_r B_{r,x}</annotation></semantics></math>
if applied over the long-term. However, this solution does not result in
each region reaching equilibrium at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,x}</annotation></semantics></math>.
Note that the same value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>x</mi></msub><annotation encoding="application/x-tex">F_x</annotation></semantics></math>
is applied to each region in the global SPR case.</p>
<p>Deriving global SPR reference points requires a different set of
inputs. These include:</p>
<ul>
<li>the relative fishing mortality between fleets
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>r</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>=</mo><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>f</mi></msub><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Frat_{r,f} = Fmort_{r,y = term,f} / \sum_f Fmort_{r,y = term,f}</annotation></semantics></math>),</li>
<li>fleet-specific fishery selectivity
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>e</mi><msubsup><mi>l</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mrow><mi>F</mi><mi>s</mi><mi>h</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">Sel_{r,y = term,a,s = 1,f}^{Fsh}</annotation></semantics></math>),</li>
<li>natural mortality for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">NatMort_{r,y=1,a,s=1}</annotation></semantics></math>),</li>
<li>weight at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">W_{r,y=1,a,s=1}</annotation></semantics></math>),</li>
<li>maturity at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">Mat_{r,y=1,a,s=1}</annotation></semantics></math>),</li>
<li>spawn timing
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>s</mi><mi>p</mi><mi>w</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">t_{spwn}</annotation></semantics></math>),</li>
<li>a vector of recruitment values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Rec_{r,y,s}</annotation></semantics></math>),</li>
<li>a matrix of movement values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐌</mi><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mspace width="0.167em"></mspace><mi>a</mi><mo>,</mo><mspace width="0.167em"></mspace><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{M}_{y = \text{term},\, a,\, s = 1}</annotation></semantics></math>)</li>
<li>the recruitment sex ratio
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ψ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\psi_s</annotation></semantics></math>),</li>
<li>recruitment age
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">RecAge</annotation></semantics></math>),</li>
<li>the first year in the recruitment vector
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">RecYear</annotation></semantics></math>)
to be used for mean recruitment calculations, and</li>
<li>the recruitment proportions (apportionment) by area
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ζ</mi><mi>r</mi></msub><annotation encoding="application/x-tex">\zeta_r</annotation></semantics></math>).</li>
</ul>
<p>Global SPR reference points are calculated by first setting the
regional numbers-at-age in the per-recruit model equal to the estimated
recruitment apportionment parameters
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ζ</mi><mi>r</mi></msub><annotation encoding="application/x-tex">\zeta_r</annotation></semantics></math>),
which sum to 1:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><msub><mi>ζ</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
N_{r,a = 1}^{\text{fished}} = \zeta_r
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><msub><mi>ζ</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
N_{r,a = 1}^{\text{unfished}} = \zeta_r
</annotation></semantics></math></p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><annotation encoding="application/x-tex">N_{r,a=1}^{\text{fished}}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><annotation encoding="application/x-tex">N_{r,a=1}^{\text{unfished}}</annotation></semantics></math>
represent the regional numbers-at-age per recruit (for the first age
class) under fished and unfished conditions, respectively.</p>
<p>Subsequently, movement is applied. If recruits are allowed to move,
the movement matrix is applied starting from age 1; otherwise, it is
applied starting from age 2:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><msub><mi>𝐌</mi><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mo>min</mo></msub><mo>,</mo><mi>…</mi><mo>,</mo><mi>A</mi><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>a</mi><mo>min</mo></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if recruits move</mtext></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>2</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\boldsymbol{N}_a^{\text{fished}} = (\boldsymbol{N}_a^{\text{fished}})^\top \boldsymbol{M}_{y = \text{term}, a, s = 1} \quad \text{for } a = a_{\min}, \dots, A, \quad a_{\min} = 
\begin{cases} 
1 &amp; \text{if recruits move} \\
2 &amp; \text{otherwise}
\end{cases}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><msub><mi>𝐌</mi><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mo>min</mo></msub><mo>,</mo><mi>…</mi><mo>,</mo><mi>A</mi><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>a</mi><mo>min</mo></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if recruits move</mtext></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>2</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\boldsymbol{N}_a^{\text{unfished}} = (\boldsymbol{N}_a^{\text{unfished}})^\top \boldsymbol{M}_{y = \text{term}, a, s = 1} \quad \text{for } a = a_{\min}, \dots, A, \quad a_{\min} = 
\begin{cases} 
1 &amp; \text{if recruits move} \\
2 &amp; \text{otherwise}
\end{cases}
</annotation></semantics></math></p>
<p>In these expressions,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
denotes the number of modeled ages
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">n_{ages}</annotation></semantics></math>)
in <code>SPoRC</code> multiplied by 10. For example, if 30 ages are
modeled, then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mn>300</mn></mrow><annotation encoding="application/x-tex">A = 300</annotation></semantics></math>.
This extension enables iterative propagation of the plus group under
movement, given that no closed-form solution exists. For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>&gt;</mo><msub><mi>n</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">a &gt; n_{ages}</annotation></semantics></math>
in <code>SPoRC</code>, all demographic and fishery parameters are held
constant at the values for the terminal modeled age
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">n_{ages}</annotation></semantics></math>).
Following movement processes, an exponential mortality model is then
applied:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><msub><mi>F</mi><mi>x</mi></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">
N_{r,a}^{\text{fished}} = N_{r,a - 1}^{\text{fished}} \cdot \exp\left(-\left(NatMort_{r,y=1,a-1,s=1} + \sum_f \text{Frat}_{r,f} \cdot F_{x} \cdot \text{Sel}_{r,y=\text{term},a-1,s=1,f}^{\text{Fsh}}\right)\right)
\quad \text{if } 2 &lt; a &lt; A
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">
N_{r,a}^{\text{unfished}} = N_{r,a - 1}^{\text{unfished}} \cdot \exp\left(-\left(NatMort_{r,y=1,a-1,s=1}\right)\right)
\quad \text{if } 2 &lt; a &lt; A
</annotation></semantics></math></p>
<p>Again, fished and unfished numbers at age per recruit can then be
converted to spawning biomass per recruit quantities:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><msub><mi>F</mi><mi>x</mi></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB^{\text{fished}}_r = \sum_a N_{r,a}^{\text{fished}} \cdot W_{r,y=1,a,s=1} \cdot \text{Mat}_{r,y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{r,y=1,a,s=1} + \sum_f \text{Frat}_{r,f} \cdot F_x \cdot \text{Sel}_{r,y=\text{term},a,s=1,f}^{\text{Fsh}} \right)
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB^{\text{unfished}}_r = \sum_a N_{r,a}^{\text{unfished}} \cdot W_{r,y=1,a,s=1} \cdot \text{Mat}_{r,y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{r,y=1,a,s=1} \right)
</annotation></semantics></math></p>
<p>and the global spawning potential ratio can then be computed as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>P</mi><mi>R</mi><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mi>r</mi></munder><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup></mrow><mrow><munder><mo>∑</mo><mi>r</mi></munder><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">
SPR = \frac{\sum_r SSB^{\text{fished}}_r}{\sum_r SSB^{\text{fished}}_r}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>x</mi></msub><annotation encoding="application/x-tex">F_x</annotation></semantics></math>
is solved for using a non-linear function minimzer by minimizing the
following criteria for global SPR:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>x</mi></msub><mo>=</mo><mo>arg</mo><munder><mo>min</mo><mi>F</mi></munder><mrow><mo stretchy="true" form="prefix">{</mo><mn>100</mn><mo>⋅</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">SPR</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>F</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mtext mathvariant="normal">x%</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">
F_x = \arg\min_{F} \left\{ 100 \cdot \left( \text{SPR}(F) - \text{x%} \right)^2 \right\}
</annotation></semantics></math></p>
<p>Then, biological SPR-based reference points are assumed to be
regional
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,x}</annotation></semantics></math>)
and are derived by multiplying the fished spawning biomass per recruit
by regional mean recruitment over a user-defined period and the
recruitment sex-ratio:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><mo>=</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><mrow><mi>Y</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi></mrow></munderover><mi>R</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><mrow><mi>Y</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></mfrac><msub><mi>ψ</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">
B_{r,x} = SSB^{\text{fished}}_r \cdot \frac{\sum_{RecYear}^{Y - RecAge} Rec_{r,y,s}}{Y - RecAge - RecYear} \psi_s
</annotation></semantics></math></p>
<p>Thus, the global SPR calculations result in a global
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>x</mi></msub><annotation encoding="application/x-tex">F_x</annotation></semantics></math>
and regional
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,x}</annotation></semantics></math>
estimates.</p>
</div>
</div>
<div class="section level4">
<h4 id="maximum-sustainble-yield-reference-points-beverton-holt">Maximum Sustainble Yield Reference Points (Beverton-Holt)<a class="anchor" aria-label="anchor" href="#maximum-sustainble-yield-reference-points-beverton-holt"></a>
</h4>
<p>MSY-based reference points assuming a Beverton-Holt stock recruitment
relationship can be derived either assuming independent populations
without movement or a global population with movement processes
incorporated.</p>
<div class="section level5">
<h5 id="independent-1">Independent<a class="anchor" aria-label="anchor" href="#independent-1"></a>
</h5>
<p>Deriving MSY reference points assuming independent populations is
similar to a single-region case, and results in region-specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">F_{r,msy}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,msy}</annotation></semantics></math>
estimates, which can be applied to each region when conducting catch
projections to determine management advice.In general, all calcualtions
are computed in the same manner as equations described for computing MSY
in the <a href="#sglregionmsy">single region case</a>, with the
exception that demographic rates and fishery selectivity include a
region subscript. Notably, virgin recruitment is considered regional to
compute equilibrium recruitment in these calculations and is derived in
the following manner:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>r</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>=</mo><msub><mi>R</mi><mn>0</mn></msub><msub><mi>ζ</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
R_{r,0} = R_0 \zeta_r 
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><msub><mi>q</mi><mi>r</mi></msub><mo>=</mo><mfrac><mrow><mn>4</mn><mo>⋅</mo><msub><mi>h</mi><mi>r</mi></msub><mo>⋅</mo><msub><mi>R</mi><mrow><mi>r</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>⋅</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup></mrow><mrow><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>h</mi><mi>r</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo>⋅</mo><msub><mi>h</mi><mi>r</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
Req_r = \frac{4\cdot h_r \cdot R_{r,0} \cdot SSB_r^{\text{fished}}}{SSB_r^{\text{unfished}} \cdot (1 - h_r) + SSB_r^{\text{fished}} \cdot (5 \cdot h_r - 1)}
</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">F_{r,msy}</annotation></semantics></math>
is then derived by minimizing (maximizing) yield for each region
independently:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>=</mo><mo>arg</mo><munder><mo>min</mo><msub><mi>F</mi><mi>r</mi></msub></munder><mi>Y</mi><mi>i</mi><mi>e</mi><mi>l</mi><msub><mi>d</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
F_{r,msy} = \arg\min_{F_r} Yield_r
</annotation></semantics></math></p>
<p>and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,msy}</annotation></semantics></math>
can then be derived as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>=</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mrow><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mi>R</mi><mi>e</mi><msub><mi>q</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
B_{r,msy} = SSB_r^{fished} Req_r
</annotation></semantics></math></p>
</div>
<div class="section level5">
<h5 id="global-1">Global<a class="anchor" aria-label="anchor" href="#global-1"></a>
</h5>
<p>Deriving global MSY in a spatial cointext requires movement among
regions to be accounted for. Similar to the global SPR case, this
results in a global
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">F_{msy}</annotation></semantics></math>
estimate, but regional estiamtes of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,msy}</annotation></semantics></math>
because recruitment parameters are defined regionally. This results in a
reference point that achieves
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>r</mi></msub><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_r B_{r,msy}</annotation></semantics></math>
for the entire population if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">F_{msy}</annotation></semantics></math>
is applied to each region, but does not ensure that each region is at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,msy}</annotation></semantics></math>.</p>
<p>Global MSY reference points requires the following inputs:</p>
<ul>
<li>the relative fishing mortality between fleets
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>r</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>=</mo><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub><mi>/</mi><msub><mo>∑</mo><mi>f</mi></msub><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Frat_{r,f} = Fmort_{r,y = term,f} / \sum_f Fmort_{r,y = term,f}</annotation></semantics></math>),</li>
<li>fleet-specific fishery selectivity
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>e</mi><msubsup><mi>l</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mrow><mi>F</mi><mi>s</mi><mi>h</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">Sel_{r,y = term,a,s = 1,f}^{Fsh}</annotation></semantics></math>),</li>
<li>natural mortality for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">NatMort_{r,y=1,a,s=1}</annotation></semantics></math>),</li>
<li>weight at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">W_{r,y=1,a,s=1}</annotation></semantics></math>),</li>
<li>maturity at age for females
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">Mat_{r,y=1,a,s=1}</annotation></semantics></math>),</li>
<li>spawn timing
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>s</mi><mi>p</mi><mi>w</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">t_{spwn}</annotation></semantics></math>),</li>
<li>a vector of recruitment values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Rec_{r,y,s}</annotation></semantics></math>),</li>
<li>a matrix of movement values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐌</mi><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mspace width="0.167em"></mspace><mi>a</mi><mo>,</mo><mspace width="0.167em"></mspace><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{M}_{y = \text{term},\, a,\, s = 1}</annotation></semantics></math>)</li>
<li>the recruitment sex ratio
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ψ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\psi_s</annotation></semantics></math>),</li>
<li>recruitment age
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>A</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">RecAge</annotation></semantics></math>),</li>
<li>the first year in the recruitment vector
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">RecYear</annotation></semantics></math>)
to be used for mean recruitment calculations,</li>
<li>the global steepness value to be used, which is taken as the mean
across all regions if steepness is estimated to be regional
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mfrac><mrow><msub><mo>∑</mo><mi>r</mi></msub><msub><mi>h</mi><mi>r</mi></msub></mrow><msub><mi>n</mi><mrow><mi>r</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>s</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">h = \frac{\sum_r h_r}{n_{regions}}</annotation></semantics></math>),
and</li>
<li>the recruitment proportions (apportionment) by area
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ζ</mi><mi>r</mi></msub><annotation encoding="application/x-tex">\zeta_r</annotation></semantics></math>).</li>
</ul>
<p>Using standard per-recruit calculations, we will first define the
initial number of fished and unfished individuals based on the
recruitment proportions to each area:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><msub><mi>ζ</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
N_{r,a = 1}^{\text{fished}} = \zeta_r 
</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><msub><mi>ζ</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
N_{r,a = 1}^{\text{unfished}} = \zeta_r
</annotation></semantics></math></p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><annotation encoding="application/x-tex">N_{r,a=1}^{\text{fished}}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><annotation encoding="application/x-tex">N_{r,a=1}^{\text{unfished}}</annotation></semantics></math>
represent the regional numbers-at-age per recruit (for the first age
class) under fished and unfished conditions, respectively. We can then
apply movement dynamics. If recruits are allowed to move, the movement
matrix is applied starting from age 1; otherwise, it is applied starting
from age 2:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><msub><mi>𝐌</mi><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mo>min</mo></msub><mo>,</mo><mi>…</mi><mo>,</mo><mi>A</mi><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>a</mi><mo>min</mo></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if recruits move</mtext></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>2</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\boldsymbol{N}_a^{\text{fished}} = (\boldsymbol{N}_a^{\text{fished}})^\top \boldsymbol{M}_{y = \text{term}, a, s = 1} \quad \text{for } a = a_{\min}, \dots, A, \quad a_{\min} = 
\begin{cases} 
1 &amp; \text{if recruits move} \\
2 &amp; \text{otherwise}
\end{cases}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>𝐍</mi><mi>a</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><msub><mi>𝐌</mi><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mo>min</mo></msub><mo>,</mo><mi>…</mi><mo>,</mo><mi>A</mi><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>a</mi><mo>min</mo></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if recruits move</mtext></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>2</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\boldsymbol{N}_a^{\text{unfished}} = (\boldsymbol{N}_a^{\text{unfished}})^\top \boldsymbol{M}_{y = \text{term}, a, s = 1} \quad \text{for } a = a_{\min}, \dots, A, \quad a_{\min} = 
\begin{cases} 
1 &amp; \text{if recruits move} \\
2 &amp; \text{otherwise}
\end{cases}
</annotation></semantics></math></p>
<p>In these expressions,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
denotes the number of modeled ages
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">n_{ages}</annotation></semantics></math>)
in <code>SPoRC</code> multiplied by 10. For example, if 30 ages are
modeled, then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mn>300</mn></mrow><annotation encoding="application/x-tex">A = 300</annotation></semantics></math>.
This extension enables iterative propagation of the plus group under
movement, given that no closed-form solution exists. For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>&gt;</mo><msub><mi>n</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">a &gt; n_{ages}</annotation></semantics></math>
in <code>SPoRC</code>, all demographic and fishery parameters are held
constant at the values for the terminal modeled age
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">n_{ages}</annotation></semantics></math>).
After movement processes occur, an exponential mortality model is then
applied:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">
N_{r,a}^{\text{fished}} = N_{r,a - 1}^{\text{fished}} \cdot \exp\left(-\left(NatMort_{r,y=1,a-1,s=1} + \sum_f \text{Frat}_{r,f} \cdot F_{msy} \cdot \text{Sel}_{r,y=\text{term},a-1,s=1,f}^{\text{Fsh}}\right)\right)
\quad \text{if } 2 &lt; a &lt; A
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>2</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">
N_{r,a}^{\text{unfished}} = N_{r,a - 1}^{\text{unfished}} \cdot \exp\left(-\left(NatMort_{r,y=1,a-1,s=1}\right)\right)
\quad \text{if } 2 &lt; a &lt; A
</annotation></semantics></math></p>
<p>Baranov’s catch equation is then invoked to compute yield per recruit
in each regio:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow></msub><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><msub><mi>F</mi><mtext mathvariant="normal">msy</mtext></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><msub><mi>F</mi><mtext mathvariant="normal">msy</mtext></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mfrac><mo>⋅</mo><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>−</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><msub><mi>F</mi><mtext mathvariant="normal">msy</mtext></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><msub><mi>n</mi><mtext mathvariant="normal">ages</mtext></msub><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
C_{r,a} = 
\frac{
  \sum_f \text{Frat}_{r,f} \cdot F_{\text{msy}} \cdot \text{Sel}_{r,y=\text{term},a-1,s=1,f}^{\text{Fsh}}
}{
  \left(NatMort_{r,y=1,a-1,s=1} + \sum_f \text{Frat}_{r,f} \cdot F_{\text{msy}} \cdot \text{Sel}_{r,y=\text{term},a-1,s=1,f}^{\text{Fsh}}\right)
}
\cdot
N_{r,a}^{\text{fished}} \cdot 
\left(
  1 - \exp\left[
    -\left(
      NatMort_{r,y=1,n_{\text{ages}},s=1} + \sum_f \text{Frat}_{r,f} \cdot F_{\text{msy}} \cdot \text{Sel}_{r,y=\text{term},n_{\text{ages}},s=1,f}^{\text{Fsh}}
    \right)
  \right]
\right)
</annotation></semantics></math></p>
<p>Equilibrium recruitment is then computed using the Beverton-Holt
stock recruitment relationship, where we first need to derive the
quantities for fished and unfished spawning biomass per recruit:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>+</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mtext mathvariant="normal">Frat</mtext><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>⋅</mo><msubsup><mtext mathvariant="normal">Sel</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>f</mi></mrow><mtext mathvariant="normal">Fsh</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB_r^{\text{fished}} = \sum_a N_{r,a}^{\text{fished}} \cdot W_{r,y=1,a,s=1} \cdot \text{Mat}_{r,y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{r,y=1,a,s=1} + \sum_f \text{Frat}_{r,f} \cdot F_{msy} \cdot \text{Sel}_{r,y=\text{term},a,s=1,f}^{\text{Fsh}} \right)
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msubsup><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Mat</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>t</mi><mtext mathvariant="normal">spwn</mtext></msub><mo>⋅</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
SSB_r^{\text{unfished}} = \sum_a N_{r,a}^{\text{unfished}} \cdot W_{r,y=1,a,s=1} \cdot \text{Mat}_{r,y=1,a,s=1} \cdot \exp\left(-t_{\text{spwn}} \cdot NatMort_{r,y=1,a,s=1} \right)
</annotation></semantics></math></p>
<p>Calculations for equilibrium recruitment then follow as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><msub><mi>q</mi><mi>r</mi></msub><mo>=</mo><mfrac><mrow><mn>4</mn><mo>⋅</mo><msub><mi>h</mi><mi>r</mi></msub><mo>⋅</mo><msub><mi>R</mi><mn>0</mn></msub><msub><mi>ζ</mi><mi>r</mi></msub><mo>⋅</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup></mrow><mrow><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">fished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo>⋅</mo><mi>h</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
Req_r = \frac{4\cdot h_r \cdot R_{0} \zeta_r \cdot SSB_r^{\text{fished}}}{SSB_r^{\text{unfished}} \cdot (1 - h) + SSB_r^{\text{fished}} \cdot (5 \cdot h - 1)}
</annotation></semantics></math></p>
<p>Lastly, yield and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{r,msy}</annotation></semantics></math>
can then be calculated by multiplying per recruit quantities by
equilibrium recruitment:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mi>i</mi><mi>e</mi><mi>l</mi><msub><mi>d</mi><mi>r</mi></msub><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><munder><mo>∑</mo><mi>r</mi></munder><msub><mi>C</mi><mrow><mi>r</mi><mo>,</mo><mi>a</mi></mrow></msub><mo>⋅</mo><mi>R</mi><mi>e</mi><msub><mi>q</mi><mi>r</mi></msub><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>=</mo><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mrow><mi>f</mi><mi>i</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mo>⋅</mo><mi>R</mi><mi>e</mi><msub><mi>q</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
Yield_r = \sum_a \sum_r C_{r,a} \cdot Req_r
B_{r,msy} = SSB_r^{fished} \cdot Req_r
</annotation></semantics></math></p>
<p>and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">F_{msy}</annotation></semantics></math>
is solved for by minimizing (or maximizing) the system wide yield:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>=</mo><mo>arg</mo><munder><mo>min</mo><mi>F</mi></munder><mi>Y</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">
F_{msy} = \arg\min_{F} Yield
</annotation></semantics></math></p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="deriving-catch-advice-and-projections">Deriving Catch Advice and Projections<a class="anchor" aria-label="anchor" href="#deriving-catch-advice-and-projections"></a>
</h2>
<p>A core part of the assessment process is to convert reference point
estimates into catch advice. In the following sections, we will
mathematically describe how catch advice is derived, and proceed to
provide code examples for demonstration. To conduct projection from the
terminal year, users must define the following quantities:</p>
<ul>
<li>Terminal year estimates of numbers-at-age,</li>
<li>A user defined period of of recruitment values to use,</li>
<li>A user defined period of weight-at-age values to use for
projections,</li>
<li>A user defined period of natural mortality-atage values to use for
projections,</li>
<li>A user defined period of maturity-at-age values to use for
projections,</li>
<li>A user defined period of fishery selectivity values to use for
projections,</li>
<li>A user defined period of movement values to use for
projections,</li>
<li>Terminal year estimates of fishing mortality,</li>
<li>Fishing mortality rate to use to decrement the population,</li>
</ul>
<p>Optionally, users can define:</p>
<ul>
<li>Biological reference points to use to project fishing mortality in
the subsequent years, if a harvest control rule is utilized, and</li>
<li>A function describing a harvest control rule.</li>
</ul>
<p>In the first year of the projection period, projected fishing
mortality is determined with estimates of fishing mortality in the
terminal year of the assessment:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>=</mo><munder><mo>∑</mo><mi>f</mi></munder><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
projF_{r,y} = \sum_f Fmort_{r,y = term,f}
</annotation></semantics></math></p>
<p>Total mortality can then be computed as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>=</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>⋅</mo><mi>F</mi><mi>r</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>⋅</mo><mi>S</mi><mi>e</mi><msubsup><mi>l</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>f</mi></mrow><mrow><mi>F</mi><mi>s</mi><mi>h</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">
F_{r,y,a,s,f} = projF_{r,y} \cdot Frat_{r,f} \cdot Sel^{Fsh}_{r,y,a,s,f} 
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>=</mo><munder><mo>∑</mo><mi>f</mi></munder><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>+</mo><mi>N</mi><mi>a</mi><mi>t</mi><mi>M</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
Z_{r,y,a,s,f} = \sum_f F_{r,y,a,s,f} + NatMort_{r,y,a,s}
</annotation></semantics></math></p>
<p>Similarly, projected numbers at age in the first year utilizes
estimates of numbers at age in the terminal year of the assessment, for
which movement has already been applied. An exponential mortality model
is then used to determine the numbers at age in the next year
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y+1</annotation></semantics></math>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mo>=</mo><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
projN_{r,y,a,s} = N_{r,y = term,a,s}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>+</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>=</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>Z</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mn>1</mn><mo>≤</mo><mi>a</mi><mo>&lt;</mo><msub><mi>a</mi><mo>+</mo></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>+</mo><mn>1</mn><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mo>=</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>Z</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>Z</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mo>+</mo></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
projN_{r,y+1,a+1,s} = projN_{r,y,a,s}\exp(-Z_{r,y,a,s}), \quad \text{for } 1 \leq a &lt; a_+ \\
projN_{r,y+1,a,s} = projN_{r,y,a-1,s}\exp(-Z_{r,y,a-1,s}) + projN_{r,y,a,s}\exp(-Z_{r,y,a,s}), \quad \text{for } a = a_+
\end{aligned}
</annotation></semantics></math></p>
<p>Quantities of spawning stock biomass can then be computed as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>S</mi><mi>S</mi><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>=</mo><munderover><mo>∑</mo><mi>a</mi><mrow><mi>a</mi><mo>+</mo></mrow></munderover><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mi>M</mi><mi>a</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">
projSSB_{r,y} = \sum_a^{a+} projN_{r,y,a,s=1}W_{r,y,a,s=1}Mat_{r,y,a,s=1}
</annotation></semantics></math></p>
<p>Additionally, quantities of projected catch can be derived using
Baranov’s catch equation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msubsup><mi>C</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>f</mi></mrow><mi>a</mi></msubsup><mo>=</mo><mfrac><mrow><mi>F</mi><mi>m</mi><mi>o</mi><mi>r</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>f</mi></mrow></msub><mi>S</mi><mi>e</mi><msubsup><mi>l</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>f</mi></mrow><mrow><mi>F</mi><mi>s</mi><mi>h</mi></mrow></msubsup></mrow><msub><mi>Z</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub></mfrac><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mi>Z</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
projC^a_{r,y,a,s,f} = \frac{Fmort_{r,y,f}Sel^{Fsh}_{r,y,a,s,f}}{Z_{r,y,a,s}} projN_{r,y,a,s} \left[1-\exp(-Z_{r,y,a,s})\right]
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>C</mi><mi>a</mi><mi>t</mi><mi>c</mi><msub><mi>h</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>f</mi></mrow></msub><mo>=</mo><munderover><mo>∑</mo><mi>a</mi><msub><mi>a</mi><mo>+</mo></msub></munderover><munderover><mo>∑</mo><mi>s</mi><msub><mi>n</mi><mi>s</mi></msub></munderover><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msubsup><mi>C</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>,</mo><mi>f</mi></mrow><mi>a</mi></msubsup><msub><mi>W</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
projCatch_{r,y,f} = \sum_a^{a_+} \sum_s^{n_s} projC^a_{r,y,a,s,f} W_{r,y,a,s}
</annotation></semantics></math></p>
<p>Fishing mortality in the next year can then be projected forward
using either a harvest control rule, or projected forward using user
inputs:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mi>S</mi><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>;</mo><mi>B</mi><mi>R</mi><msub><mi>P</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>;</mo><mi>F</mi><mi>R</mi><msub><mi>P</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if using a HCR</mtext></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>F</mi><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if using a user defined fishing mortality rate</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
projF_{r,y+1} = 
\begin{cases}
f(SSB_{r,y}; BRP_{r,y}; FRP_{r,y}) &amp; \text{if using a HCR}  \\ 
f(Finput_{r,y}) &amp; \text{if using a user defined fishing mortality rate} 
\end{cases}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f()</annotation></semantics></math>
is a harvest control function that takes the inputs
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>S</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">SSB</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>R</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">BRP</annotation></semantics></math>
(biological reference points), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>R</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">FRP</annotation></semantics></math>
(a fishery reference point). Alternatively,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f()</annotation></semantics></math>
can be a user defined matrix of fishing mortality rates to use during
the projection period across regions. Projected fishing mortality is
then summed with natural mortaltiy to compute the projected total
mortality in a given projection year.</p>
<p>Recruitment dynamics are then projected in each year following the
initial projection year. In particular, several recruitment projection
options are availiable. These include both deterministic predictions as
well as the ability to incorporate stochasticity into recruitment
projections.</p>
<p>In particular, deterministic recruitment has the option to be
projected forward as <code>zero</code>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>=</mo><mn>0</mn><mo>,</mo><mtext mathvariant="normal">if y &gt; 1</mtext></mrow><annotation encoding="application/x-tex">
projN_{r,y,1,s} = 0, \text{if y &gt; 1}
</annotation></semantics></math></p>
<p>where no recruitment occurs. Deterministic recruitment can also be
projected forward using mean recruitment (<code>mean_rec</code>) from a
matrix of estimated recruitment values from the assessment model
supplied by the user:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mi>y</mi></munder><mi>R</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub></mrow><mi>n</mi></mfrac><mo>,</mo><mtext mathvariant="normal">if y &gt; 1</mtext></mrow><annotation encoding="application/x-tex">
projN_{r,y,1,s} = \frac{\sum_y Rec_{r,y}}{n}, \text{if y &gt; 1}
</annotation></semantics></math></p>
<p>Alternatively, users can also specify a Beverton-Holt stock
recruitment function (<code>bh_rec</code>) to be used for deterministic
recruitment projection, which then requires users to supply the
necessary parameter inputs. In the case where local recruitment is
specified, this is computed as (i.e., metapopulation dynamics):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>=</mo><mfrac><mrow><mn>4</mn><mo>⋅</mo><msub><mi>h</mi><mi>r</mi></msub><mo>⋅</mo><msub><mi>R</mi><mrow><mi>r</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>⋅</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>S</mi><mi>S</mi><msub><mi>B</mi><mi>r</mi></msub></mrow><mrow><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>h</mi><mi>r</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>S</mi><mi>S</mi><msub><mi>B</mi><mi>r</mi></msub><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo>⋅</mo><msub><mi>h</mi><mi>r</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
projN_{r,y,1,s} = \frac{4\cdot h_r \cdot R_{r,0} \cdot projSSB_r}{SSB_r^{\text{unfished}} \cdot (1 - h_r) + projSSB_r \cdot (5 \cdot h_r - 1)}
</annotation></semantics></math></p>
<p>By contrast, if global recruitment is specified, this is computed
as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><msub><mi>N</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mn>4</mn><mo>⋅</mo><mi>h</mi><mo>⋅</mo><msub><mi>R</mi><mn>0</mn></msub><mo>⋅</mo><munder><mo>∑</mo><mi>r</mi></munder><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>S</mi><mi>S</mi><msub><mi>B</mi><mi>r</mi></msub></mrow><mrow><munder><mo>∑</mo><mi>r</mi></munder><mi>S</mi><mi>S</mi><msubsup><mi>B</mi><mi>r</mi><mtext mathvariant="normal">unfished</mtext></msubsup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mi>r</mi></munder><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>S</mi><mi>S</mi><msub><mi>B</mi><mi>r</mi></msub><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo>⋅</mo><mi>h</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ζ</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
projN_{r,y,1,s} = \left( \frac{4\cdot h \cdot R_{0} \cdot \sum_r projSSB_r}{\sum_r SSB_r^{\text{unfished}} \cdot (1 - h) + \sum_r projSSB_r \cdot (5 \cdot h - 1)} \right) \zeta_r
</annotation></semantics></math></p>
<p>where density-dependence occurs globally, and a recruitment
apportionment parameter is utilized to partition global recruits in a
given year.</p>
<p>Lastly, users can specify recruitment projections to be stochastic,
wherein an inverse Gaussian (<code>inv_gauss</code>) distribution
parameterized based on estimated recruitment values from the assessment
model is utilized to project recruitment into the future:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">AMeanRec</mtext><mi>r</mi></msub><mo>=</mo><mfrac><mn>1</mn><mi>Y</mi></mfrac><munderover><mo>∑</mo><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><mi>Y</mi></munderover><msub><mtext mathvariant="normal">Rec</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
\text{AMeanRec}_r = \frac{1}{Y} \sum_{y=1}^{Y} \text{Rec}_{r,y}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">HMeanRec</mtext><mi>r</mi></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mi>Y</mi></mfrac><munderover><mo>∑</mo><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><mi>Y</mi></munderover><mfrac><mn>1</mn><msub><mtext mathvariant="normal">Rec</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">
\text{HMeanRec}_r = \left( \frac{1}{Y} \sum_{y=1}^{Y} \frac{1}{\text{Rec}_{r,y}} \right)^{-1}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mi>r</mi></msub><mo>=</mo><mfrac><msub><mtext mathvariant="normal">AMeanRec</mtext><mi>r</mi></msub><msub><mtext mathvariant="normal">HMeanRec</mtext><mi>r</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">
\gamma_r = \frac{\text{AMeanRec}_r}{\text{HMeanRec}_r}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>r</mi></msub><mo>=</mo><msub><mtext mathvariant="normal">AMeanRec</mtext><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">
\beta_r = \text{AMeanRec}_r
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mi>r</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi>γ</mi><mi>r</mi></msub><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\delta_r = \frac{1}{\gamma_r - 1}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">CVRec</mtext><mi>r</mi></msub><mo>=</mo><msqrt><mfrac><mn>1</mn><msub><mi>δ</mi><mi>r</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">
\text{CVRec}_r = \sqrt{ \frac{1}{\delta_r} }
</annotation></semantics></math></p>
<p>For each year a random draw is made from a standard normal
distribution, which is then transformed:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ψ</mi><mi>y</mi></msub><mo>=</mo><msubsup><mi>B</mi><mi>y</mi><mn>2</mn></msubsup><mo>,</mo><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">where </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>B</mi><mi>y</mi></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
    \psi_y = B_y^2, \quad \text{where } B_y \sim N(0,1)
    </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ω</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>=</mo><msub><mi>β</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><msub><mi>ψ</mi><mi>y</mi></msub><mo>−</mo><msqrt><mrow><mn>4</mn><msub><mi>δ</mi><mi>r</mi></msub><msub><mi>ψ</mi><mi>y</mi></msub><mo>+</mo><msubsup><mi>ψ</mi><mi>y</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><mrow><mn>2</mn><msub><mi>δ</mi><mi>r</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
  \omega_{r,y} = \beta_r \left( 1 + \frac{\psi_y - \sqrt{4 \delta_r \psi_y + \psi_y^2}}{2 \delta_r} \right)
  </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ζ</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>=</mo><msub><mi>β</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><msub><mi>ψ</mi><mi>y</mi></msub><mo>+</mo><msqrt><mrow><mn>4</mn><msub><mi>δ</mi><mi>r</mi></msub><msub><mi>ψ</mi><mi>y</mi></msub><mo>+</mo><msubsup><mi>ψ</mi><mi>y</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><mrow><mn>2</mn><msub><mi>δ</mi><mi>r</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
  \zeta_{r,y} = \beta_r \left( 1 + \frac{\psi_y + \sqrt{4 \delta_r \psi_y + \psi_y^2}}{2 \delta_r} \right)
  </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>β</mi><mi>r</mi></msub><mrow><msub><mi>β</mi><mi>r</mi></msub><mo>+</mo><msub><mi>ω</mi><mrow><mi>r</mi><mo>,</mo><mi>i</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
  \theta_{r,y} = \frac{\beta_r}{\beta_r + \omega_{r,i}}
</annotation></semantics></math></p>
<p>Then, a draw is conducted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sim U(0,1)</annotation></semantics></math>,
and simulated recruitment is defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mtext mathvariant="normal">Rec</mtext><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow><mtext mathvariant="normal">sim</mtext></msubsup><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>ω</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>U</mi><mi>y</mi></msub><mo>≤</mo><msub><mi>θ</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>ζ</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi></mrow></msub><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
  \text{Rec}_{r,y}^{\text{sim}} =
    \begin{cases}
  \omega_{r,y}, &amp; \text{if } U_y \leq \theta_{r,y} \\
  \zeta_{r,y}, &amp; \text{otherwise}
  \end{cases}
  </annotation></semantics></math></p>
<p>Thus, this inverse gaussian mixture ensures the simulated values have
approximately the correct mean and variability based on historical
recruitment values.</p>
<p>After recruitment processes occur, the usual dynamics are then
applied to project the population forward. Here, movement of individuals
first occurs:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mrow><mi>𝐩</mi><mi>𝐫</mi><mi>𝐨</mi><mi>𝐣</mi><mi>𝐍</mi></mrow><mi>a</mi><mo>=</mo></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mrow><mi>𝐩</mi><mi>𝐫</mi><mi>𝐨</mi><mi>𝐣</mi><mi>𝐍</mi></mrow><mi>a</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><msub><mi>𝐌</mi><mrow><mi>y</mi><mo>=</mo><mtext mathvariant="normal">term</mtext><mo>,</mo><mi>a</mi><mo>,</mo><mi>s</mi><mo>=</mo><mn>1</mn></mrow></msub><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mo>=</mo><msub><mi>a</mi><mo>min</mo></msub><mo>,</mo><mi>…</mi><mo>,</mo><mi>A</mi><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>a</mi><mo>min</mo></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if recruits move</mtext></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>2</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\boldsymbol{projN}_a^ = (\boldsymbol{projN}_a)^\top \boldsymbol{M}_{y = \text{term}, a, s = 1} \quad \text{for } a = a_{\min}, \dots, A, \quad a_{\min} = 
\begin{cases} 
1 &amp; \text{if recruits move} \\
2 &amp; \text{otherwise}
\end{cases}
</annotation></semantics></math></p>
<p>Following movement, which is only applied in projected years
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y &gt; 1</annotation></semantics></math>,
as it has already been accounted for in the terminal year estimates of
numbers at age, the exponential mortality model is applied. Projected
spawning stock biomass and catch are then derived. Fishing mortality in
subsequent years is updated accordingly. This sequence of steps is
repeated until the specified number of projection years is reached.
Thus, catch advice for the year following the terminal assessment year
corresponds to the projected catch in projection year 2 (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>C</mi><mi>a</mi><mi>t</mi><mi>c</mi><msub><mi>h</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>=</mo><mn>2</mn><mo>,</mo><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">projCatch_{r, y = 2, f}</annotation></semantics></math>).</p>
</div>
<div class="section level2">
<h2 id="code-demonstration">Code Demonstration<a class="anchor" aria-label="anchor" href="#code-demonstration"></a>
</h2>
<p>In the subsequent sections, we will demonstrate how reference points,
catch projections, catch advice, and stochastic projections can be
derived and conducted using <code>SPoRC</code>. These features rely on
users to have a report file from a <code>SPoRC</code> model, and we have
generally coded this in a way that there is flexibility for users to
define how projections are done.</p>
<div class="section level3">
<h3 id="getting-reference-points">Getting Reference Points<a class="anchor" aria-label="anchor" href="#getting-reference-points"></a>
</h3>
<div class="section level4">
<h4 id="single-region-1">Single Region<a class="anchor" aria-label="anchor" href="#single-region-1"></a>
</h4>
<p>To illustrate how reference points are derived, we begin by
extracting the report file from the single-region sablefish case study
(sgl_rg_sable_rep). We then call the Get_Reference_Points function to
calculate the reference points. In the example below, we estimate the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mn>40</mn></msub><annotation encoding="application/x-tex">F_{40}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mn>40</mn></msub><annotation encoding="application/x-tex">B_{40}</annotation></semantics></math>
values in a single-region context. This requires passing the sablefish
data file (<code>sgl_reg_sable_data</code>) to the data argument, the
report file to the rep argument, and setting the SPR rate
(<code>SPR_x</code>) to 0.4. We also specify that the reference point is
SPR-based and pertains to a single region. Additional inputs include the
first year of recruitment used for calculating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mn>40</mn></msub><annotation encoding="application/x-tex">B_{40}</annotation></semantics></math>,
the recruitment age (which excludes the last <code>rec_age</code> years
when computing the mean), the timing of spawning, and the sex ratio used
in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mn>40</mn></msub><annotation encoding="application/x-tex">B_{40}</annotation></semantics></math>
calculation. Note that the sablefish example does not utilize a stock
recruitment relationship. However, if a Beverton-Holt stock recruitment
relationship is utilized and users want to estimate MSY-based reference
points, this can be derived by setting <code>what = 'BH_MSY'</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sgl_rg_sable_rep"</span><span class="op">)</span> <span class="co"># read in single region report</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sgl_rg_sable_data"</span><span class="op">)</span> <span class="co"># read in single region data </span></span>
<span></span>
<span><span class="co"># single area model</span></span>
<span><span class="va">sgl_ref_pt</span> <span class="op">&lt;-</span> <span class="fu">SPoRC</span><span class="fu">::</span><span class="fu"><a href="../reference/Get_Reference_Points.html">Get_Reference_Points</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sgl_rg_sable_data</span>, <span class="co"># data file</span></span>
<span>                                          rep <span class="op">=</span> <span class="va">sgl_rg_sable_rep</span>, <span class="co"># report file</span></span>
<span>                                          SPR_x <span class="op">=</span> <span class="fl">0.4</span>, <span class="co"># spr rate</span></span>
<span>                                          type <span class="op">=</span> <span class="st">'single_region'</span>, <span class="co"># single region reference point</span></span>
<span>                                          what <span class="op">=</span> <span class="st">'SPR'</span>, <span class="co"># SPR reference point</span></span>
<span>                                          calc_rec_st_yr <span class="op">=</span> <span class="fl">20</span>, <span class="co"># first year to calculate mean recruitment</span></span>
<span>                                          rec_age <span class="op">=</span> <span class="fl">2</span>,  <span class="co"># exclues the last rec_age years when computing mean recruitment</span></span>
<span>                                          t_spwn <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># spawn timing</span></span>
<span>                                          sex_ratio_f <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># recruitment sex-ratio for females</span></span>
<span>                                          <span class="op">)</span></span>
<span><span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">f_ref_pt</span> <span class="co"># F40</span></span>
<span><span class="co">#&gt; [1] 0.08631906</span></span>
<span><span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">b_ref_pt</span> <span class="co"># B40</span></span>
<span><span class="co">#&gt; [1] 121.0546</span></span></code></pre></div>
<p>Note that the sablefish example does not utilize a stock recruitment
relationship. However, if a Beverton-Holt stock recruitment relationship
is utilized and users want to estimate MSY-based reference points, this
can be derived by setting <code>what = 'BH_MSY'</code>.</p>
</div>
<div class="section level4">
<h4 id="multi-region-1">Multi Region<a class="anchor" aria-label="anchor" href="#multi-region-1"></a>
</h4>
<p>In the following, we will demonstrate how spatial reference points
can be derived. In general, this is similar to the single region case,
except that a spatial model and associated report files will be needed
(report file needs to be spatially-explicit). Again, we will use the
five-region sablefish case study as an example, where we will estimate
both independent SPR rates and global SPR rates. In contrast to the
single region case, <code>type</code> would now need to be specified as
<code>multi_region</code>. Additionally, for independent SPR rates where
movement dynamics are ignored, <code>what</code> is now set at
<code>independent_SPR</code>. All the other arguments are defined the
same as the example above. Given that these are treated as independent
populations, fishery reference points and biological reference points
are region-specific and can be applied accordingly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mlt_rg_sable_rep"</span><span class="op">)</span> <span class="co"># read in multi region report</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mlt_rg_sable_data"</span><span class="op">)</span> <span class="co"># read in multi region data </span></span>
<span></span>
<span><span class="co"># multi region model with independent SPR</span></span>
<span><span class="va">mlt_ref_pt_indp</span> <span class="op">&lt;-</span> <span class="fu">SPoRC</span><span class="fu">::</span><span class="fu"><a href="../reference/Get_Reference_Points.html">Get_Reference_Points</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mlt_rg_sable_data</span>, <span class="co"># data file</span></span>
<span>                                          rep <span class="op">=</span> <span class="va">mlt_rg_sable_rep</span>, <span class="co"># report file</span></span>
<span>                                          SPR_x <span class="op">=</span> <span class="fl">0.4</span>, <span class="co"># spr rate</span></span>
<span>                                          type <span class="op">=</span> <span class="st">'multi_region'</span>, <span class="co"># multi region reference point</span></span>
<span>                                          what <span class="op">=</span> <span class="st">'independent_SPR'</span>, <span class="co"># SPR reference point</span></span>
<span>                                          calc_rec_st_yr <span class="op">=</span> <span class="fl">20</span>, <span class="co"># first year to calculate mean recruitment</span></span>
<span>                                          rec_age <span class="op">=</span> <span class="fl">2</span>,  <span class="co"># exclues the last rec_age years when computing mean recruitment</span></span>
<span>                                          t_spwn <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># spawn timing</span></span>
<span>                                          sex_ratio_f <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># recruitment sex-ratio for females</span></span>
<span>                                          <span class="op">)</span></span>
<span><span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">f_ref_pt</span> <span class="co"># F40</span></span>
<span><span class="co">#&gt; [1] 0.08242958 0.08191864 0.07998789 0.08040071 0.07969338</span></span>
<span><span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">b_ref_pt</span> <span class="co"># B40</span></span>
<span><span class="co">#&gt; [1] 31.46321 24.63865 20.11382 33.32957 13.30036</span></span></code></pre></div>
<p>By contrast, users can also specify global SPR rates. This involves
simply changing the <code>what</code> argument to
<code>global_SPR</code>, which results in a single
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mn>40</mn></msub><annotation encoding="application/x-tex">F_{40}</annotation></semantics></math>
being estimated, but region-specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mn>40</mn></mrow></msub><annotation encoding="application/x-tex">B_{r,40}</annotation></semantics></math>
given that regional estimates of recruitment are utilized. Note that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mn>40</mn></msub><annotation encoding="application/x-tex">F_{40}</annotation></semantics></math>
outputs 5 values for the 5 regions modelled in the case study, but these
values are all identical.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mlt_rg_sable_rep"</span><span class="op">)</span> <span class="co"># read in multi region report</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mlt_rg_sable_data"</span><span class="op">)</span> <span class="co"># read in multi region data </span></span>
<span></span>
<span><span class="co"># multi region model with global SPR</span></span>
<span><span class="va">mlt_ref_pt_global</span> <span class="op">&lt;-</span> <span class="fu">SPoRC</span><span class="fu">::</span><span class="fu"><a href="../reference/Get_Reference_Points.html">Get_Reference_Points</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mlt_rg_sable_data</span>, <span class="co"># data file</span></span>
<span>                                                 rep <span class="op">=</span> <span class="va">mlt_rg_sable_rep</span>, <span class="co"># report file</span></span>
<span>                                                 SPR_x <span class="op">=</span> <span class="fl">0.4</span>, <span class="co"># spr rate</span></span>
<span>                                                 type <span class="op">=</span> <span class="st">'multi_region'</span>, <span class="co"># multi region reference point</span></span>
<span>                                                 what <span class="op">=</span> <span class="st">'global_SPR'</span>, <span class="co"># SPR reference point</span></span>
<span>                                                 calc_rec_st_yr <span class="op">=</span> <span class="fl">20</span>, <span class="co"># first year to calculate mean recruitment</span></span>
<span>                                                 rec_age <span class="op">=</span> <span class="fl">2</span>,  <span class="co"># exclues the last rec_age years when computing mean recruitment</span></span>
<span>                                                 t_spwn <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># spawn timing</span></span>
<span>                                                 sex_ratio_f <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># recruitment sex-ratio for females</span></span>
<span>                                                 <span class="op">)</span></span>
<span><span class="va">mlt_ref_pt_global</span><span class="op">$</span><span class="va">f_ref_pt</span> <span class="co"># F40</span></span>
<span><span class="co">#&gt; [1] 0.07997762 0.07997762 0.07997762 0.07997762 0.07997762</span></span>
<span><span class="va">mlt_ref_pt_global</span><span class="op">$</span><span class="va">b_ref_pt</span> <span class="co"># B40</span></span>
<span><span class="co">#&gt; [1] 31.46321 24.63865 20.11382 33.32957 13.30036</span></span></code></pre></div>
<p>Similarly, MSY-based reference points assuming a Beverton-Holt stock
recruitment function can be specified as well. This can be easily
specified and involves either assuming independent populations
(<code>what = 'independent_BH_MSY'</code>) or a population with global
density dependence (<code>what = 'global_BH_MSY'</code>).</p>
</div>
</div>
<div class="section level3">
<h3 id="conducting-catch-projections-to-derive-catch-advice-deterministic-recruitment">Conducting Catch Projections to Derive Catch Advice (Deterministic
Recruitment)<a class="anchor" aria-label="anchor" href="#conducting-catch-projections-to-derive-catch-advice-deterministic-recruitment"></a>
</h3>
<div class="section level4">
<h4 id="single-region-2">Single Region<a class="anchor" aria-label="anchor" href="#single-region-2"></a>
</h4>
<p>Next, using the reference points derived from the single region case
study, we can conduct population and catch projections to derive catch
advice. Note that this will require users to have a data file to extract
the relevant demographic rates and data components, as well as a report
file to extract necessary estimates to conduct projections. Let us first
define a threshold harvest control rule to utilize in our population
projections, although note that this is not strictly necessary.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define HCR to use</span></span>
<span><span class="va">HCR_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">frp</span>, <span class="va">brp</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">stock_status</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="va">brp</span> <span class="co"># define stock status</span></span>
<span>  <span class="co"># If stock status is &gt; 1</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">stock_status</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="va">frp</span></span>
<span>  <span class="co"># If stock status is between brp and alpha</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">stock_status</span> <span class="op">&gt;</span> <span class="va">alpha</span> <span class="op">&amp;&amp;</span> <span class="va">stock_status</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="va">frp</span> <span class="op">*</span> <span class="op">(</span><span class="va">stock_status</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="co"># If stock status is less than alpha</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">stock_status</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a tibble for plotting</span></span>
<span><span class="va">hcr_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,</span>
<span>  SSB_B40 <span class="op">=</span> <span class="va">i</span> <span class="op">/</span> <span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">b_ref_pt</span>,</span>
<span>  F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">i</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">HCR_function</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, frp <span class="op">=</span> <span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">f_ref_pt</span>, brp <span class="op">=</span> <span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">b_ref_pt</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hcr_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SSB_B40</span>, y <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"SSB / B40"</span>, y <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/i_threshold_hcr.png"></p>
<p>We can define all the inputs needed to run the population
projection:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sgl_rg_sable_rep"</span><span class="op">)</span> <span class="co"># read in single region report</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sgl_rg_sable_data"</span><span class="op">)</span> <span class="co"># read in single region data </span></span>
<span></span>
<span><span class="co"># Setup necessary inputs</span></span>
<span><span class="va">t_spawn</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># spawn timing</span></span>
<span><span class="va">sexratio</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># sex ratio</span></span>
<span><span class="va">n_proj_yrs</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># number of projection years</span></span>
<span><span class="va">n_regions</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># number of regions</span></span>
<span><span class="va">n_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span> <span class="co"># number of ages</span></span>
<span><span class="va">n_sexes</span> <span class="op">&lt;-</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_sexes</span> <span class="co"># number of sexes</span></span>
<span><span class="va">n_fish_fleets</span> <span class="op">&lt;-</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_fish_fleets</span> <span class="co"># number of fishery fleets</span></span>
<span><span class="va">do_recruits_move</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># recruits don't move</span></span>
<span><span class="va">terminal_NAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># terminal numbers at age</span></span>
<span><span class="va">WAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">WAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># weight at age</span></span>
<span><span class="va">MatAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">MatAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># maturity at age</span></span>
<span><span class="va">fish_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">fish_sel</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span>, <span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> <span class="co"># selectivity</span></span>
<span><span class="va">Movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">Movement</span><span class="op">[</span>,,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># movement</span></span>
<span><span class="va">terminal_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">Fmort</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> <span class="co"># terminal F</span></span>
<span><span class="va">natmort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">natmort</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># natural mortality</span></span>
<span><span class="va">recruitment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">[</span>,<span class="fl">20</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">20</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># recruitment values to use for mean recruitment calculations or inverse gaussian parameterization</span></span>
<span></span>
<span><span class="co"># Define reference points to use in HCR</span></span>
<span><span class="va">f_ref_pt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">f_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b_ref_pt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">b_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that in these projections, all demographic rates (e.g.,
weight-at-age, movement, maturity) use estimates from the terminal year
of the assessment. However, this is not required - users may instead
define demographic rates for the projection period using other
approaches (e.g., averages over the last 5 years). Regardless of the
approach, rates must be provided by the user in the format and
dimensions described above. A population projection can then be
conducted with the <code>Do_Population_Projection</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># do population projection</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Do_Population_Projection.html">Do_Population_Projection</a></span><span class="op">(</span>n_proj_yrs <span class="op">=</span> <span class="va">n_proj_yrs</span>, <span class="co"># Number of projection years</span></span>
<span>                               n_regions <span class="op">=</span> <span class="va">n_regions</span>, <span class="co"># number of regions</span></span>
<span>                               n_ages <span class="op">=</span> <span class="va">n_ages</span>, <span class="co"># number of ages</span></span>
<span>                               n_sexes <span class="op">=</span> <span class="va">n_sexes</span>, <span class="co"># number of sexes</span></span>
<span>                               sexratio <span class="op">=</span> <span class="va">sexratio</span>, <span class="co"># sex ratio for recruitment</span></span>
<span>                               n_fish_fleets <span class="op">=</span> <span class="va">n_fish_fleets</span>, <span class="co"># number of fishery fleets</span></span>
<span>                               do_recruits_move <span class="op">=</span> <span class="va">do_recruits_move</span>, <span class="co"># whether recruits move (not used since single area)</span></span>
<span>                               recruitment <span class="op">=</span> <span class="va">recruitment</span>, <span class="co"># recruitment values to use for mean recruitment </span></span>
<span>                               terminal_NAA <span class="op">=</span> <span class="va">terminal_NAA</span>, <span class="co"># terminal numbers at age</span></span>
<span>                               terminal_F <span class="op">=</span> <span class="va">terminal_F</span>, <span class="co"># terminal F</span></span>
<span>                               natmort <span class="op">=</span> <span class="va">natmort</span>, <span class="co"># natural mortality values to use in projection</span></span>
<span>                               WAA <span class="op">=</span> <span class="va">WAA</span>, <span class="co"># weight at age values to use in projection</span></span>
<span>                               MatAA <span class="op">=</span> <span class="va">MatAA</span>, <span class="co"># maturity at age values to use in projection</span></span>
<span>                               fish_sel <span class="op">=</span> <span class="va">fish_sel</span>, <span class="co"># fishery selectivity values to use in projection</span></span>
<span>                               Movement <span class="op">=</span> <span class="va">Movement</span>, <span class="co"># movement values (not used since single area)</span></span>
<span>                               f_ref_pt <span class="op">=</span> <span class="va">f_ref_pt</span>, <span class="co"># fishery reference points (f40)</span></span>
<span>                               b_ref_pt <span class="op">=</span> <span class="va">b_ref_pt</span>, <span class="co"># biological reference points (b40)</span></span>
<span>                               HCR_function <span class="op">=</span> <span class="va">HCR_function</span>, <span class="co"># threshold control rule defined above</span></span>
<span>                               recruitment_opt <span class="op">=</span> <span class="st">"mean_rec"</span>, <span class="co"># recruitment assumption utilizes the mean recruits for the supplied recruitment estimates</span></span>
<span>                               fmort_opt <span class="op">=</span> <span class="st">"HCR"</span>, <span class="co"># Fishing mortality in projection years are determined using a HCR</span></span>
<span>                               t_spawn <span class="op">=</span> <span class="va">t_spawn</span> <span class="co"># Spawn timing</span></span>
<span>                               <span class="op">)</span></span></code></pre></div>
<p>The outputted object from the function then includes the projected
fishing mortality rates, the projected catch (i.e., the catch advice),
the projected spawning stock biomass, the projected numbers at age, and
the projected total mortality at age. We can plot a few of these
quantities out below. In the example below, we show the projected
SSB:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">SSB</span><span class="op">[</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">65</span><span class="op">]</span>, <span class="va">out</span><span class="op">$</span><span class="va">proj_SSB</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># removing terminal year becauase repeated in projection calculations</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">1960</span><span class="op">:</span><span class="op">(</span><span class="fl">2023</span> <span class="op">+</span> <span class="va">n_proj_yrs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssb_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Year <span class="op">=</span> <span class="va">years</span>,</span>
<span>  SSB <span class="op">=</span> <span class="va">combined_ssb</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ssb_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">SSB</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2024</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># projection start</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"SSB (kt)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/i_sgl_proj_ssb.png"></p>
<p>as well as projected catches, which can then be the basis of
management advice:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_catch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">PredCatch</span><span class="op">[</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">65</span>, <span class="op">]</span><span class="op">)</span>, <span class="co"># removing terminal year becauase repeated in projection calculations</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">proj_Catch</span><span class="op">[</span><span class="fl">1</span>, , <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">1960</span><span class="op">:</span><span class="op">(</span><span class="fl">2023</span> <span class="op">+</span> <span class="va">n_proj_yrs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">catch_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Year <span class="op">=</span> <span class="va">years</span>,</span>
<span>  Catch <span class="op">=</span> <span class="va">combined_catch</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">catch_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Catch</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2024</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># projection start</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Catch (kt)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">proj_Catch</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># Catch advice in terminal year + 1</span></span></code></pre></div>
<p><img src="figures/i_sgl_proj_catch.png"></p>
<p>Importantly, catch advice should be based on terminal year+1 rather
than the first projection year, since the first projection year serves
only as an initialization step for the projection.</p>
</div>
<div class="section level4">
<h4 id="multi-region-2">Multi Region<a class="anchor" aria-label="anchor" href="#multi-region-2"></a>
</h4>
<p>In the following, we will then demonstrate how catch projections can
be conducted in a multi-region context, using independent SPR rates,
such that there are region-specific estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>r</mi><mo>,</mo><mn>40</mn></mrow></msub><annotation encoding="application/x-tex">F_{r,40}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>r</mi><mo>,</mo><mn>40</mn></mrow></msub><annotation encoding="application/x-tex">B_{r,40}</annotation></semantics></math>.
In general, the steps are similar to the single-region case. Again, we
will utilize the harvest control rule function defined above. Given that
each region has their own unique estimates, this will result in
different harvest control rules being applied to each region:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define HCR to use</span></span>
<span><span class="va">HCR_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">frp</span>, <span class="va">brp</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">stock_status</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="va">brp</span> <span class="co"># define stock status</span></span>
<span>  <span class="co"># If stock status is &gt; 1</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">stock_status</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="va">frp</span></span>
<span>  <span class="co"># If stock status is between brp and alpha</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">stock_status</span> <span class="op">&gt;</span> <span class="va">alpha</span> <span class="op">&amp;&amp;</span> <span class="va">stock_status</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="va">frp</span> <span class="op">*</span> <span class="op">(</span><span class="va">stock_status</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="co"># If stock status is less than alpha</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">stock_status</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Build a dataframe by looping over j and i scalars</span></span>
<span><span class="va">hcr_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    frp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">f_ref_pt</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">j</span><span class="op">)</span>,</span>
<span>    brp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">b_ref_pt</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">j</span><span class="op">)</span>,</span>
<span>    F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">HCR_function</span><span class="op">(</span>x <span class="op">=</span> <span class="va">i</span>, frp <span class="op">=</span> <span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">f_ref_pt</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, brp <span class="op">=</span> <span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">b_ref_pt</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, <span class="va">i</span>, <span class="va">j</span><span class="op">)</span>,</span>
<span>    SSB_B40 <span class="op">=</span> <span class="va">i</span> <span class="op">/</span> <span class="va">brp</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hcr_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SSB_B40</span>, y <span class="op">=</span> <span class="cn">F</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">j</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"SSB / B40"</span>, y <span class="op">=</span> <span class="st">"F"</span>,  color <span class="op">=</span> <span class="st">'Region'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/i_mlt_threshold_hcr.png"></p>
<p>Let’s then define all the inputs needed to run the population
projection:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mlt_rg_sable_rep"</span><span class="op">)</span> <span class="co"># read in multi region report</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mlt_rg_sable_data"</span><span class="op">)</span> <span class="co"># read in multi region data </span></span>
<span></span>
<span><span class="co"># Setup necessary inputs</span></span>
<span><span class="va">t_spawn</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># spawn timing</span></span>
<span><span class="va">sexratio</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># sex ratio</span></span>
<span><span class="va">n_proj_yrs</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># number of projection years</span></span>
<span><span class="va">n_regions</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># number of regions</span></span>
<span><span class="va">n_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span> <span class="co"># number of ages</span></span>
<span><span class="va">n_sexes</span> <span class="op">&lt;-</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">n_sexes</span> <span class="co"># number of sexes</span></span>
<span><span class="va">n_fish_fleets</span> <span class="op">&lt;-</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">n_fish_fleets</span> <span class="co"># number of fishery fleets</span></span>
<span><span class="va">do_recruits_move</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># recruits don't move</span></span>
<span><span class="va">terminal_NAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># terminal numbers at age</span></span>
<span><span class="va">WAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">WAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># weight at age</span></span>
<span><span class="va">MatAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">MatAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># maturity at age</span></span>
<span><span class="va">fish_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">fish_sel</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span>, <span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> <span class="co"># selectivity</span></span>
<span><span class="va">Movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm</a></span><span class="op">(</span><span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html" class="external-link">abind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_proj_yrs</span>, <span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">Movement</span><span class="op">[</span>,,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, along <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, perm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="co"># movement</span></span>
<span><span class="va">terminal_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">Fmort</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> <span class="co"># terminal F</span></span>
<span><span class="va">natmort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">natmort</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># natural mortality</span></span>
<span><span class="va">recruitment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">[</span>,<span class="fl">20</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">20</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># recruitment values to use for mean recruitment calculations or inverse gaussian parameterization</span></span>
<span></span>
<span><span class="co"># Define independent SPR reference points to use in HCR</span></span>
<span><span class="va">f_ref_pt_indp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">f_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b_ref_pt_indp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_ref_pt_indp</span><span class="op">$</span><span class="va">b_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>When global reference points (SPR or MSY-based) are used, the same
fishing mortality
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>)
is applied across all regions because only a single global
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is estimated. This is illustrated below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_ref_pt_global</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_ref_pt_global</span><span class="op">$</span><span class="va">f_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b_ref_pt_global</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">mlt_ref_pt_global</span><span class="op">$</span><span class="va">b_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By contrast, the independent SPR approach assigns a region-specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
value. For example, in the first projection year:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># F40</span></span>
<span><span class="va">f_ref_pt_indp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># independent SPR</span></span>
<span><span class="co">#&gt; [1] 0.08242958 0.08191864 0.07998789 0.08040071 0.07969338</span></span>
<span><span class="va">f_ref_pt_global</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># global SPR</span></span>
<span><span class="co">#&gt; [1] 0.07997762 0.07997762 0.07997762 0.07997762 0.07997762</span></span>
<span></span>
<span><span class="co"># b40</span></span>
<span><span class="va">b_ref_pt_indp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># independent SPR</span></span>
<span><span class="co">#&gt; [1] 31.46321 24.63865 20.11382 33.32957 13.30036</span></span>
<span><span class="va">b_ref_pt_global</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># global SPR</span></span>
<span><span class="co">#&gt; [1] 31.46321 24.63865 20.11382 33.32957 13.30036</span></span></code></pre></div>
<p>For the projections that follow, we use independent SPR rates to
allow for region-specific reference points:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># do population projection</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Do_Population_Projection.html">Do_Population_Projection</a></span><span class="op">(</span>n_proj_yrs <span class="op">=</span> <span class="va">n_proj_yrs</span>, <span class="co"># Number of projection years</span></span>
<span>                              n_regions <span class="op">=</span> <span class="va">n_regions</span>, <span class="co"># number of regions</span></span>
<span>                              n_ages <span class="op">=</span> <span class="va">n_ages</span>, <span class="co"># number of ages</span></span>
<span>                              n_sexes <span class="op">=</span> <span class="va">n_sexes</span>, <span class="co"># number of sexes</span></span>
<span>                              sexratio <span class="op">=</span> <span class="va">sexratio</span>, <span class="co"># sex ratio for recruitment</span></span>
<span>                              n_fish_fleets <span class="op">=</span> <span class="va">n_fish_fleets</span>, <span class="co"># number of fishery fleets</span></span>
<span>                              do_recruits_move <span class="op">=</span> <span class="va">do_recruits_move</span>, <span class="co"># whether recruits move (not used since single area)</span></span>
<span>                              recruitment <span class="op">=</span> <span class="va">recruitment</span>, <span class="co"># recruitment values to use for mean recruitment </span></span>
<span>                              terminal_NAA <span class="op">=</span> <span class="va">terminal_NAA</span>, <span class="co"># terminal numbers at age</span></span>
<span>                              terminal_F <span class="op">=</span> <span class="va">terminal_F</span>, <span class="co"># terminal F</span></span>
<span>                              natmort <span class="op">=</span> <span class="va">natmort</span>, <span class="co"># natural mortality values to use in projection</span></span>
<span>                              WAA <span class="op">=</span> <span class="va">WAA</span>, <span class="co"># weight at age values to use in projection</span></span>
<span>                              MatAA <span class="op">=</span> <span class="va">MatAA</span>, <span class="co"># maturity at age values to use in projection</span></span>
<span>                              fish_sel <span class="op">=</span> <span class="va">fish_sel</span>, <span class="co"># fishery selectivity values to use in projection</span></span>
<span>                              Movement <span class="op">=</span> <span class="va">Movement</span>, <span class="co"># movement values (not used since single area)</span></span>
<span>                              f_ref_pt <span class="op">=</span> <span class="va">f_ref_pt_indp</span>, <span class="co"># fishery reference points (f40)</span></span>
<span>                              b_ref_pt <span class="op">=</span> <span class="va">b_ref_pt_indp</span>, <span class="co"># biological reference points (b40)</span></span>
<span>                              HCR_function <span class="op">=</span> <span class="va">HCR_function</span>, <span class="co"># threshold control rule defined above</span></span>
<span>                              recruitment_opt <span class="op">=</span> <span class="st">"mean_rec"</span>, <span class="co"># recruitment assumption utilizes the mean recruits for the supplied recruitment estimates</span></span>
<span>                              fmort_opt <span class="op">=</span> <span class="st">"HCR"</span>, <span class="co"># Fishing mortality in projection years are determined using a HCR</span></span>
<span>                              t_spawn <span class="op">=</span> <span class="va">t_spawn</span> <span class="co"># Spawn timing</span></span>
<span>                              <span class="op">)</span></span></code></pre></div>
<p>Again, we can visualize what these projections look like in terms of
SSB and catch advice:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">SSB</span><span class="op">[</span>,<span class="op">-</span><span class="fl">62</span><span class="op">]</span>, <span class="va">out</span><span class="op">$</span><span class="va">proj_SSB</span><span class="op">[</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># removing terminal year becauase repeated in projection calculations</span></span>
<span><span class="va">combined_ssb_df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">combined_ssb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, SSB <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">combined_ssb_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span> <span class="op">+</span> <span class="fl">1959</span>, y <span class="op">=</span> <span class="va">SSB</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Region</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2021</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># projection start</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Region</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"SSB (kt)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/i_mlt_proj_ssb.png"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_catch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mlt_rg_sable_rep</span><span class="op">$</span><span class="va">PredCatch</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">proj_Catch</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">combined_catch_df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">combined_catch</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span>, Catch <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">combined_catch_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span> <span class="op">+</span> <span class="fl">1959</span>, y <span class="op">=</span> <span class="va">Catch</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Region</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2021</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># projection start</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Region</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Catch"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">proj_Catch</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># Catch advice by region in terminal year + 1</span></span></code></pre></div>
<p><img src="figures/i_mlt_proj_catch.png"></p>
</div>
</div>
<div class="section level3">
<h3 id="conducting-stochastic-population-projections">Conducting Stochastic Population Projections<a class="anchor" aria-label="anchor" href="#conducting-stochastic-population-projections"></a>
</h3>
<p>In the final section of this vignette, we demonstrate how to conduct
stochastic population projections. For simplicity, we focus on the
single-region case, though the approach extends similarly to
multi-region scenarios. Stochastic projections follow the same general
structure as deterministic ones, with the key difference being that
<code>recruitment_opt = 'inv_gauss</code>’ is specified to introduce
variability in recruitment. For demonstration purposes, we will set up
the following projection scenarios, which include:</p>
<ol style="list-style-type: decimal">
<li>Using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mn>40</mn></msub><annotation encoding="application/x-tex">F_{40}</annotation></semantics></math>
for projections, where an HCR is applied to adjust the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mn>40</mn></msub><annotation encoding="application/x-tex">F_{40}</annotation></semantics></math>
in each projection year,</li>
<li>Using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">F = 0</annotation></semantics></math>
for projections.</li>
</ol>
<p>Let us first redefine our single region inputs to use in our
projection function, but also define the number of simulations to
conduct (1000):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sgl_rg_sable_rep"</span><span class="op">)</span> <span class="co"># read in single region report</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sgl_rg_sable_data"</span><span class="op">)</span> <span class="co"># read in single region data </span></span>
<span></span>
<span><span class="co"># Setup necessary inputs</span></span>
<span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fl">1e3</span> <span class="co"># number of simulations to conduct</span></span>
<span><span class="va">t_spawn</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># spawn timing</span></span>
<span><span class="va">sexratio</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># sex ratio</span></span>
<span><span class="va">n_proj_yrs</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># number of projection years</span></span>
<span><span class="va">n_regions</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># number of regions</span></span>
<span><span class="va">n_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span> <span class="co"># number of ages</span></span>
<span><span class="va">n_sexes</span> <span class="op">&lt;-</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_sexes</span> <span class="co"># number of sexes</span></span>
<span><span class="va">n_fish_fleets</span> <span class="op">&lt;-</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_fish_fleets</span> <span class="co"># number of fishery fleets</span></span>
<span><span class="va">do_recruits_move</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># recruits don't move</span></span>
<span><span class="va">terminal_NAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">NAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># terminal numbers at age</span></span>
<span><span class="va">WAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">WAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># weight at age</span></span>
<span><span class="va">MatAA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">MatAA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># maturity at age</span></span>
<span><span class="va">fish_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">fish_sel</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span>, <span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> <span class="co"># selectivity</span></span>
<span><span class="va">Movement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">Movement</span><span class="op">[</span>,,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, each <span class="op">=</span> <span class="va">n_proj_yrs</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># movement</span></span>
<span><span class="va">terminal_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">Fmort</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> <span class="co"># terminal F</span></span>
<span><span class="va">natmort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">natmort</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,,<span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_ages</span>, <span class="va">n_sexes</span><span class="op">)</span><span class="op">)</span> <span class="co"># natural mortality</span></span>
<span><span class="va">recruitment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">[</span>,<span class="fl">20</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">20</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># recruitment values to use for mean recruitment calculations or inverse gaussian parameterization</span></span></code></pre></div>
<p>We can then define our two projection scenarios to use in this
example, as well as arrays to store our projection results in:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the F used for each scenario </span></span>
<span><span class="va">proj_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># Scenario 1 - Using HCR to adjust f40</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f_ref_pt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">f_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       b_ref_pt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">b_ref_pt</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       fmort_opt <span class="op">=</span> <span class="st">'HCR'</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># Scenario 2 - F is set at 0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f_ref_pt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       b_ref_pt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       fmort_opt <span class="op">=</span> <span class="st">'Input'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># store outputs</span></span>
<span><span class="va">all_scenarios_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">proj_inputs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_scenarios_ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">proj_inputs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_scenarios_catch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="va">n_proj_yrs</span>, <span class="va">n_fish_fleets</span>, <span class="va">n_sims</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">proj_inputs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can then run our projections by iteration through our
scenarios, as well as the number of simulations to conduct. Note that we
switch from <code>fmort_opt = 'HCR'</code> to
<code>fmort_opt = 'Input'</code> when going from scenario 1 to scenario
2, given that scenario 2 does not use an HCR (the HCR used is the
threshold control rule defined earlier).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">proj_inputs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">sim</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># do population projection</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Do_Population_Projection.html">Do_Population_Projection</a></span><span class="op">(</span>n_proj_yrs <span class="op">=</span> <span class="va">n_proj_yrs</span>, <span class="co"># number of projection years</span></span>
<span>                                    n_regions <span class="op">=</span> <span class="va">n_regions</span>, <span class="co"># number of regions</span></span>
<span>                                    n_ages <span class="op">=</span> <span class="va">n_ages</span>, <span class="co"># number of ages</span></span>
<span>                                    n_sexes <span class="op">=</span> <span class="va">n_sexes</span>, <span class="co"># number of sexes</span></span>
<span>                                    sexratio <span class="op">=</span> <span class="va">sexratio</span>, <span class="co"># sex ratio</span></span>
<span>                                    n_fish_fleets <span class="op">=</span> <span class="va">n_fish_fleets</span>, <span class="co"># number of fleets</span></span>
<span>                                    do_recruits_move <span class="op">=</span> <span class="va">do_recruits_move</span>, <span class="co"># whether recruits move</span></span>
<span>                                    recruitment <span class="op">=</span> <span class="va">recruitment</span>, <span class="co"># recruitment values to use to parameterize inverse gaussian</span></span>
<span>                                    terminal_NAA <span class="op">=</span> <span class="va">terminal_NAA</span>, <span class="co"># terminal numbers at age</span></span>
<span>                                    terminal_F <span class="op">=</span> <span class="va">terminal_F</span>, <span class="co"># terminal fishing mortality at age</span></span>
<span>                                    natmort <span class="op">=</span> <span class="va">natmort</span>, <span class="co"># natural mortality </span></span>
<span>                                    WAA <span class="op">=</span> <span class="va">WAA</span>, <span class="co"># weight at age</span></span>
<span>                                    MatAA <span class="op">=</span> <span class="va">MatAA</span>, <span class="co"># maturity at age</span></span>
<span>                                    fish_sel <span class="op">=</span> <span class="va">fish_sel</span>, <span class="co"># fishery selectivity</span></span>
<span>                                    Movement <span class="op">=</span> <span class="va">Movement</span>, <span class="co"># movement</span></span>
<span>                                    f_ref_pt <span class="op">=</span> <span class="va">proj_inputs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">f_ref_pt</span>, <span class="co"># fishing mortality to use for projection</span></span>
<span>                                    b_ref_pt <span class="op">=</span> <span class="va">proj_inputs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">b_ref_pt</span>, <span class="co"># biological reference point to use in HCR</span></span>
<span>                                    HCR_function <span class="op">=</span> <span class="va">HCR_function</span>, <span class="co"># harvest control rule function</span></span>
<span>                                    recruitment_opt <span class="op">=</span> <span class="st">"inv_gauss"</span>, <span class="co"># stochastic simulation for recruitment</span></span>
<span>                                    fmort_opt <span class="op">=</span> <span class="va">proj_inputs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">fmort_opt</span>, <span class="co"># fishing mortality option (either HCR or a user input)</span></span>
<span>                                    t_spawn <span class="op">=</span> <span class="va">t_spawn</span> <span class="co"># spawn timing</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># store results</span></span>
<span>    <span class="va">all_scenarios_ssb</span><span class="op">[</span>,,<span class="va">sim</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">proj_SSB</span></span>
<span>    <span class="va">all_scenarios_catch</span><span class="op">[</span>,,,<span class="va">sim</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">proj_Catch</span></span>
<span>    <span class="va">all_scenarios_f</span><span class="op">[</span>,,<span class="va">sim</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">proj_F</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="va">n_proj_yrs</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co"># remove last year, since it's not used</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="co"># end sim loop</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># end i loop</span></span></code></pre></div>
<p>Finally, we can plot these stochastic simulations to inspect
results:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get historical SSB</span></span>
<span><span class="va">historical</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_rep</span><span class="op">$</span><span class="va">SSB</span>, <span class="va">n_sims</span><span class="op">)</span>,</span>
<span>                                   dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">n_sims</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Var2</span> <span class="op">+</span> <span class="fl">1959</span>,</span>
<span>         Scenario <span class="op">=</span> <span class="st">"FABC (F40)"</span>,  <span class="co"># or change to match the scenarios you're plotting</span></span>
<span>         Type <span class="op">=</span> <span class="st">"Historical"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Simulation <span class="op">=</span> <span class="va">Var3</span>, SSB <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get all scenario projections</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">all_scenarios_ssb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Var2</span> <span class="op">+</span> <span class="fl">2023</span>,</span>
<span>         Scenario <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>           <span class="va">Var4</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"S1: FABC (F40)"</span>,</span>
<span>           <span class="va">Var4</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"S2: F = 0"</span></span>
<span>         <span class="op">)</span>,</span>
<span>         Type <span class="op">=</span> <span class="st">"Projection"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Simulation <span class="op">=</span> <span class="va">Var3</span>, SSB <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># expand historical SSB for plotting</span></span>
<span><span class="va">scenarios_unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">$</span><span class="va">Scenario</span><span class="op">)</span></span>
<span><span class="va">historical_expanded</span> <span class="op">&lt;-</span> <span class="va">historical</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">historical</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">scenarios_unique</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">historical_expanded</span><span class="op">$</span><span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">scenarios_unique</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">historical</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine</span></span>
<span><span class="va">combined_ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">historical_expanded</span>, <span class="va">scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">combined_ssb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">SSB</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Scenario</span>, <span class="va">Simulation</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Scenario</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">sgl_ref_pt</span><span class="op">$</span><span class="va">b_ref_pt</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="co"># b40</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2024</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="co"># projection start</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Historical"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"Projection"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/i_sgl_stoch_proj_ssb.png"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get historical catch</span></span>
<span><span class="va">historical</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsCatch</span>, <span class="va">n_sims</span><span class="op">)</span>,</span>
<span>                                   dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_regions</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_fish_fleets</span>, <span class="va">n_sims</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Var2</span> <span class="op">+</span> <span class="fl">1959</span>,</span>
<span>         Scenario <span class="op">=</span> <span class="st">"FABC (F40)"</span>,  <span class="co"># or change to match the scenarios you're plotting</span></span>
<span>         Type <span class="op">=</span> <span class="st">"Historical"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Simulation <span class="op">=</span> <span class="va">Var4</span>, Fleet <span class="op">=</span> <span class="va">Var3</span>, Catch <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Var2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">historical</span><span class="op">$</span><span class="va">Catch</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">historical</span><span class="op">$</span><span class="va">Catch</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Get all scenario projections</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">all_scenarios_catch</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Var2</span> <span class="op">+</span> <span class="fl">2023</span>,</span>
<span>         Scenario <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>           <span class="va">Var5</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"S1: FABC (F40)"</span>,</span>
<span>           <span class="va">Var5</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"S2: F = 0"</span></span>
<span>         <span class="op">)</span>,</span>
<span>         Type <span class="op">=</span> <span class="st">"Projection"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Simulation <span class="op">=</span> <span class="va">Var4</span>, Catch <span class="op">=</span> <span class="va">value</span>, Fleet <span class="op">=</span> <span class="va">Var3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># expand historical SSB for plotting</span></span>
<span><span class="va">scenarios_unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">$</span><span class="va">Scenario</span><span class="op">)</span></span>
<span><span class="va">historical_expanded</span> <span class="op">&lt;-</span> <span class="va">historical</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">historical</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">scenarios_unique</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">historical_expanded</span><span class="op">$</span><span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">scenarios_unique</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">historical</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine</span></span>
<span><span class="va">combined_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">historical_expanded</span>, <span class="va">scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">combined_cat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Scenario</span>, <span class="va">Simulation</span>, <span class="va">Type</span>, <span class="va">Region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>Catch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Catch</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Catch</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Scenario</span>, <span class="va">Simulation</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Scenario</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Historical"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"Projection"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/i_sgl_stoch_proj_catch.png"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
